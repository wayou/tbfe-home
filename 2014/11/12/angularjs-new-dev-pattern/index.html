<!DOCTYPE HTML><html><head><meta charset="utf-8"><title>内部平台静态开发方案2.0 | JSBear</title><meta name="author" content="JSBear Team"><meta name="description" content="我们是一群搞前端的熊孩子:()"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta property="og:title" content="内部平台静态开发方案2.0"><meta property="og:site_name" content="JSBear"><meta property="og:image" content="undefined"><link href="/tbfe-home/favicon.png" rel="icon"><link rel="stylesheet" href="/tbfe-home/css/jquery.tocify.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/css/bootstrap.min.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/material/css/ripples.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/material/css/material.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/css/font-awesome.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/css/style.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/css/highlight.light.css" media="screen" type="text/css"><link rel="stylesheet" href="/tbfe-home/css/google-fonts.css" media="screen" type="text/css"><!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]--><script src="/tbfe-home/js/jquery-2.0.3.min.js"></script></head><body><nav id="main-nav" class="navbar navbar-default" role="navigation"><div class="container"><button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/tbfe-home/">JSBear</a><div class="collapse navbar-collapse nav-menu"><ul class="nav navbar-nav navbar-right"><li><a href="/tbfe-home/"><i class="fa fa-home"></i>首页</a></li><li><a href="/tbfe-home/archives"><i class="fa fa-list"></i>存档</a></li><li><a href="/tbfe-home/categories"><i class="fa fa-folder"></i>分类</a></li><li><a href="/tbfe-home/categories/文档/"><i class="mdi-action-description"></i>文档</a></li><li><a href="/tbfe-home/works"><i class="mdi-action-polymer"></i>Works</a></li><li><a href="/tbfe-home/about"><i class="fa fa-info-circle"></i>关于</a></li><li><a href="/tbfe-home/atom.xml"><i class="fa fa-rss"></i>RSS</a></li></ul></div></div></nav><div class="clearfix"></div><div class="container"><div class="content"><div class="page-header"><h1>内部平台静态开发方案2.0</h1></div><div class="row post"><div class="col-md-9"><div class="mypage"><div class="row widget-wrapper"><div class="post-meta-item"><i class="fa fa-clock-o"></i> <span class="post-time">2014-11-12 20:16:39</span></div><div class="post-meta-item"><i class="mdi-action-face-unlock" title="作者"></i> <span>wayou</span></div><div class="post-meta-item"><i class="fa fa-folder"></i> <a class="label label-success" href="/tbfe-home/categories/文档/">文档</a></div><div class="post-meta-item"><i class="fa fa-tags"></i> <a class="label label-warning" href="/tbfe-home/tags/angularjs/">angularjs</a> <a class="label label-warning" href="/tbfe-home/tags/开发/">开发</a></div></div><p>感谢前人「刘凯，洪堂」的成果，站在巨人的肩上继续走得更远！</p><p>基于自己开发的开发过程，和收集的各种不便，内部平台现对之前的静态开发方案进行了一次升级。<br>这次改进是尝试性的，为是探求更好的开发方式，改进现有工作流程，提升效率和使开发更方便。</p><p>同时也作为新开发方式的一种探索和实践，为新版脚手架提供参考。</p><a id="more"></a><h1 id="文件引用">文件引用</h1><p>之前使用异步拉取每个部分视图<code>controller</code>的方式在特殊需要时会有顺序的问题，以至于好多逻辑只能折中写到<code>app.js</code>文件里。现将之前异步方式改为同步，去掉<code>requirejs</code>，一次性将AngularJS程序的js文件引入。</p><p>并且Angular模块只会在调用时被实例化，所以提前到页面也不会浪费资源。</p><h1 id="目录结构">目录结构</h1><p><img src="/tbfe-home/asset/posts/2014-11-12-angularjs-new-dev-pattern/angular.png" alt=""></p><p>上图只列出了与静态文案相关的目录及文件，现描述如下：</p><h2 id="control">control</h2><p>control 文件与原来的一样</p><h2 id="template">template</h2><p><code>template 文件</code>里引用 <code>devplatcommon 基础库</code> 模块的部分与原来一样，只是引用项目启动文件的方式进行了改变。</p><p>fis配置中将会在 <code>static/project_name/</code> 下生成一个 <code>app_all.js</code> 文件，在template里面将原来引用<code>app.js</code>的地方替换为引用此文件。</p><figure class="highlight php"><figcaption><span>before</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 如下代码用将由框架负责处理js资源加载到页面</div><div class="line"> */</div><div class="line"><span class="keyword">echo</span> HTML::js(<span class="string">'project_name/app.js'</span>, <span class="string">"module_name"</span>);</div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure><figure class="highlight php"><figcaption><span>after</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 如下代码用将由框架负责处理js资源加载到页面</div><div class="line"> */</div><div class="line"><span class="keyword">echo</span> HTML::js(<span class="string">'project_name/app_all.js'</span>, <span class="string">"module_name"</span>);</div><div class="line"><span class="preprocessor">?&gt;</span></div></pre></td></tr></table></figure><p>区别在于之前在template里引用的是AngularJS的主程序入口文件，而现在的<code>app_all.js</code>是整个AngularJS程序所有文件合并的结果。</p><h2 id="static_文件夹">static 文件夹</h2><p>static里面项目的组织有变化。</p><p>先是一个<code>app文件夹</code>，以将AngularJS程序与其他静态文件区分开。</p><p>app下面是以项目为单位分开的文件夹，里面存放项目主要的静态文件，主要是:</p><ul><li><code>app.js</code> AngularJS程序的主入口文件</li><li><code>views</code>文件夹，存放部分视图<code>HTML</code> 文件及视图对应的<code>Controller</code> 文件</li><li><code>services</code> 文件夹，存放本项目公用服务</li><li><code>directives</code> 文件夹，存放项目公用<code>directive</code></li><li><code>resources</code> 文件夹，存放本项目公用<code>resource</code>文件</li><li><code>filters</code> 文件夹，存放本项目公用<code>filters</code></li></ul><h3 id="app-js">app.js</h3><p>app.js为angular程序主入口文件，与原来的app.js文件有较大区别。</p><p>这里开始定义的JS文件未采用<code>require</code>方式定义模块，而是直接通过AngularJS方式定义。</p><p>先是定义项目主模块并注入基础服务：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">module</span> = angular.module(<span class="string">'project_name'</span>, [</div><div class="line">    <span class="string">'ngRoute'</span>,</div><div class="line">    <span class="string">'ngResource'</span>,</div><div class="line">    <span class="string">'ui.bootstrap'</span>,</div><div class="line">    <span class="string">'ngCommon'</span></div><div class="line">]);</div></pre></td></tr></table></figure><p>之后是对项目进行初始配置,主要是设置路由。<br>由于不用异步拉取相应部分视图的<code>controller</code>文件，所以不用像<code>ngCommon</code> 库里面定义的<code>routeResolverProvider</code>服务那样去手动处理，而是通过AngularJS原生的方式来配置路由及指定<code>controller</code>。</p><figure class="highlight js"><figcaption><span>before</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.config([</div><div class="line">    <span class="string">'$routeProvider'</span>,</div><div class="line">    <span class="string">'routeResolverProvider'</span>,</div><div class="line">    <span class="string">'$httpProvider'</span>,</div><div class="line">    <span class="function"><span class="keyword">function</span><span class="params">($routeProvider, routeResolverProvider, $httpProvider)</span> </span>{</div><div class="line">        <span class="keyword">var</span> route = routeResolverProvider.route;</div><div class="line">        $routeProvider</div><div class="line"></div><div class="line">        .when(<span class="string">'/view1'</span>, route.resolve({</div><div class="line">            templateUrl: __uri(<span class="string">'./view/view1/view1.html'</span>),</div><div class="line">            controllerUrl: __uri(<span class="string">'./view/view1_controller.js'</span>)</div><div class="line">        }))</div><div class="line"></div><div class="line">        .when(<span class="string">'/view2'</span>, route.resolve({</div><div class="line">            templateUrl: __uri(<span class="string">'./view2/view2.html'</span>),</div><div class="line">            controllerUrl: __uri(<span class="string">'./view2/view2_controller.js'</span>)</div><div class="line">        }))</div><div class="line"></div><div class="line">        .otherwise({</div><div class="line">            redirectTo: <span class="string">'/view1'</span></div><div class="line">        });</div><div class="line"></div><div class="line">    }</div><div class="line">]);</div><div class="line"></div><div class="line"><span class="comment">// Dynamic loading controller register setup.</span></div><div class="line">angular.module(<span class="string">'ngCommon'</span>).setupRegister(<span class="built_in">module</span>);</div><div class="line"></div><div class="line">angular.bootstrap(<span class="built_in">document</span>, [<span class="built_in">module</span>.name]);</div></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>after</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">module</span>.config([</div><div class="line">    <span class="string">'$routeProvider'</span>,</div><div class="line">    <span class="string">'$httpProvider'</span>,</div><div class="line">    <span class="function"><span class="keyword">function</span><span class="params">($routeProvider, $httpProvider)</span> </span>{</div><div class="line">        $routeProvider</div><div class="line">            .when(<span class="string">'/view1'</span>, {</div><div class="line">                templateUrl: __uri(<span class="string">'./views/view1/view1.html'</span>),</div><div class="line">                controller: <span class="string">'View1Ctrl'</span></div><div class="line">            })</div><div class="line">            .when(<span class="string">'/view2'</span>, {</div><div class="line">                templateUrl: __uri(<span class="string">'./views/view2/view2.html'</span>),</div><div class="line">                controller: <span class="string">'View2Ctrl'</span></div><div class="line">            })</div><div class="line"></div><div class="line">        .otherwise({</div><div class="line">            redirectTo: <span class="string">'/view1'</span></div><div class="line">        });</div><div class="line">    }</div><div class="line">]);</div><div class="line"><span class="comment">//启动Angular程序</span></div><div class="line">angular.bootstrap(<span class="built_in">document</span>, [<span class="built_in">module</span>.name]);</div></pre></td></tr></table></figure><p>其中在<code>controller</code> 里指定controller名称,而不是对应的文件路径。同时也不需要原先<code>app.js</code> 中最后两行注册模块及启动程序的代码。</p><h3 id="views文件夹"><code>views</code>文件夹</h3><p>此文件夹下存放部分视图<code>HTML</code> 文件及视图对应的<code>Controller</code> 文件，按功能或者说按页面进行划分。</p><ul><li>view1</li><li>view2</li><li>…</li></ul><p>如果还需要本部分视图单独使用的<code>filter</code>,<code>service</code> 或<code>resource</code>等，将单独的js文件放到对应部分视图目录下即可。</p><ul><li>view1.html</li><li>view1_controller.js</li><li>…</li></ul><p>其中，现在的开发方式不需要在<code>view.html</code> 中指定<code>ng-congtroller</code>, 因为这个工作已经在路由配置时做了。</p><h3 id="services_文件夹"><code>services</code> 文件夹</h3><p>存放本项目公用服务。进行复杂业务逻辑的处理或繁杂运算等。</p><h3 id="directives_文件夹"><code>directives</code> 文件夹</h3><p>存放本项目公用的<code>directive</code>,一般是一些页面的组件。</p><h3 id="resources_文件夹"><code>resources</code> 文件夹</h3><p>存放本项目公用<code>resource</code>文件, 用于与后端交互，获取及提交数据。</p><h3 id="filters_文件夹"><code>filters</code> 文件夹</h3><p>存放本项目公用<code>filters</code>。控制页面显示，特别是一些需要处理数字文本转换，控制日期格式等的场景，还有就是页面上需要进行条件性的展示。</p><h1 id="fis-conf-js">fis-conf.js</h1><p>利用fis将所有AngularJS程序需要的JS文件打包成一个，之后再引入到<code>template</code> 文件里。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//配置要合并的代码，即之前的__merge_conf.php配置的内容</span></div><div class="line">fis.config.merge({</div><div class="line">    pack: {</div><div class="line">        <span class="string">'static/project1/app_all.js'</span>: [</div><div class="line">            <span class="regexp">/static\/project1\/.*.js/</span></div><div class="line">        ],</div><div class="line">        <span class="string">'static/project2/app_all.js'</span>: [</div><div class="line">            <span class="regexp">/static\/project2\/.*.js/</span></div><div class="line">        ]</div><div class="line">    }</div><div class="line">});</div></pre></td></tr></table></figure><h1 id="总结">总结</h1><p>除了以上变更，其他部分与之前的设计是一样的。对于开发者来说，使用起来没有额外的学习成本，只需专注开发部分视图部分，如果后期脚架支持，则开发者完全感受不到变化。<br>升级文案的落实过程中，遇到一些文件加载的问题，经过多次尝试努力后成功，感谢东伟的帮助，段君的提议等。</p><p>祝同学们开发愉快! Happy Coding~</p></div><div><center><div class="pagination-wrapper"><a class="btn btn-default disabled"><i class="fa fa-chevron-left"></i>上一篇</a> <a class="btn btn-default" href="/tbfe-home/"><i class="fa fa-home"></i>首页</a> <a class="btn btn-default" href="/tbfe-home/2014/10/22/hello-world/" class="alignright next">下一篇<i class="fa fa-chevron-right"></i></a></div></center></div><section id="comment"><div class="ds-thread" data-thread-key="_posts/2014-11-12-angularjs-new-dev-pattern.md" data-title="内部平台静态开发方案2.0" data-url="http://wayou.github.io/2014/11/12/angularjs-new-dev-pattern/"></div><script type="text/javascript">var duoshuoQuery={short_name:"tbfe"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}();</script></section></div><div class="col-md-3"><div id="toc"></div></div></div></div></div><div class="container-narrow"><footer><p>我们是来自贴吧搞前端的一群熊孩子:()</p><p>&copy; 2014 <a href="http://wayou.github.io">JSBear Team</a></p></footer></div><a id="gotop" href="#"><i class="fa fa-chevron-circle-up"></i></a><script src="/tbfe-home/js/jquery.imagesloaded.min.js"></script><script src="/tbfe-home/js/gallery.js"></script><script src="/tbfe-home/js/bootstrap.min.js"></script><script src="/tbfe-home/material/js/ripples.js"></script><script src="/tbfe-home/material/js/material.js"></script><script src="/tbfe-home/js/jqueryui.js"></script><script src="/tbfe-home/js/jquery.tocify.js"></script><script src="/tbfe-home/js/main.js"></script></body></html>